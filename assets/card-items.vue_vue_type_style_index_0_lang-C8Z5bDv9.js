import{d as Ie,bj as Le,dR as Ee,dT as qe,dU as He,r as _,X as Pe,w as Oe,G as De,aj as Ke,g as k,f as a,a as Re,o as g,b as t,t as c,v as u,m as s,aN as m,c as x,F as M,i as ge,l as C,dp as U,e as E,q as ye,ai as F,$ as W}from"./index-DuJ21lMM.js";import{_ as je}from"./AppTextarea.vue_vue_type_script_setup_true_lang-CdtiP4md.js";import{_ as Be}from"./AppTextField.vue_vue_type_script_setup_true_lang-C6eDBRMO.js";import{_ as ze}from"./AppAutocomplete.vue_vue_type_script_setup_true_lang-Mqf6sKVv.js";import{c as p}from"./common-api.web.min-DozRe4br.js";import{d as A}from"./PriceUtil-qNSdq12I.js";import{L as _e}from"./LocationSettingService-BKRWQ-g6.js";import{V as Ye,c as Me}from"./VCard-C7nUahwm.js";import{V as We}from"./VCardText-B4rK-kDH.js";import{V,a as r}from"./VRow-DGRt7Q0q.js";import{c as be,a as he,b as Ce}from"./VList-C4wVJxYD.js";import{V as X}from"./VSpacer-bpxkoT1E.js";import{V as Xe}from"./VSelect-BqFYC3zs.js";const Ge={class:"w-100"},Je={class:"whitespace-no-wrap text-truncate"},Qe={key:0,class:"block d-flex"},Ze={class:"w-100"},et={class:"whitespace-no-wrap text-truncate"},tt={key:0,class:"block d-flex"},vt=Ie({__name:"card-items",props:{serviceType:{type:String,default:()=>p.Api.HubriseServiceType.DELIVERY},reset:{type:Number,default:()=>0}},emits:["create","nextField"],setup(R,{emit:Ve}){var fe;const j=R,G=Ve,I=((fe=Le().getCurrentAccount)==null?void 0:fe.currency)??p.Api.HubriseCurrencyCode.EUR,L=p.Api.HubrisePriceUtil.amountToPrice(0,I),J=Ee(),Q=qe(),Z=He(),q=_(),$=_(),B=_(),H=_(!1);let ee=[],S=[],te={},N={};const b=_([{}]),P=_(),O=_(),ae=_(),z=_(L),le=_(),T=_(L),D=_([{value:L,name:A(L)}]),$e=()=>{if(!(!Array.isArray(b.value)||b.value.length===0))return b.value.filter(e=>"id"in e&&e.id!==void 0&&e.id!==null).length===0},h=Pe(()=>{var d;const e=q.value,l={service_type:j.serviceType,items:b.value,status:p.Api.HubriseOrderStatus.new},o=new p.Api.TotalHubriseCalculator().calculateTotals(e??void 0,l,le.value,ae.value,I);return p.Util.isNullOrUndefined(T.value)||(d=T.value)!=null&&d.startsWith("0.00")||o.deliveryFee===void 0?T.value=o.deliveryFee??null:(o.deliveryFee=T.value??void 0,o.total=p.Api.HubrisePriceUtil.sum([o.subtotal,o.minimumOrderFee,o.deliveryFee,p.Api.HubrisePriceUtil.multiply(o.totalDiscount,-1)])),o}),oe=e=>{if(typeof e=="object"&&e!==null)switch(j.serviceType){case p.Api.HubriseServiceType.DELIVERY:return`${e.delivery}%`;case p.Api.HubriseServiceType.COLLECTION:return`${e.collection}%`;case p.Api.HubriseServiceType.EAT_IN:return`${e.eat_in}%`}return""},ne=()=>{if($.value===void 0||$.value===null)return;const l=new p.Api.HubriseCatalogConverter().editableItems($.value,B.value??void 0);ee=l.withRef,S=l.withName},se=()=>{if($.value===void 0||$.value===null)return;const l=new p.Api.HubriseCatalogConverter().editableItemOptions($.value,B.value??void 0);te=l.withRef,N=l.withName},K=()=>{b.value.push({})},we=e=>{const l=b.value.findIndex(o=>o===e);l>=0&&b.value.splice(l,1)},Y=e=>{Array.isArray(e.options)||(e.options=[]),e.options.push({})},ke=(e,l)=>{const o=e.options.findIndex(d=>d===l);o>=0&&e.options.splice(o,1)},re=(e,l)=>{const o=S==null?void 0:S.find(d=>d.id===e);o===void 0?Object.keys(l).forEach(d=>delete l[d]):(p.Util.ObjectUtil.update(l,o),Array.isArray(N[e])&&N[e].length>0?Y(l):K())},ie=(e,l,o)=>{var y;const d=(y=N[e])==null?void 0:y.find(v=>v.id===l);if(d===void 0)Object.keys(o).forEach(v=>delete o[v]);else{const v=b.value.find(n=>n.id===e);p.Util.ObjectUtil.update(o,d),Y(v)}},Ue=()=>{var l,o;H.value=!0,setTimeout(()=>H.value=!1,1e3);const e=[];!p.Util.isNullOrUndefined(h.value.minimumOrderFee)&&!((l=h.value.minimumOrderFee)!=null&&l.startsWith("0.00"))&&e.push({name:m("page.order.add.section.item.minimumOrderFee"),price:h.value.minimumOrderFee}),!p.Util.isNullOrUndefined(h.value.deliveryFee)&&!((o=h.value.deliveryFee)!=null&&o.startsWith("0.00"))&&e.push({name:m("page.order.add.section.item.deliveryFee"),price:h.value.deliveryFee}),G("create",{items:b.value,charges:e,customerNotes:P.value,sellerNotes:O.value})},de=e=>{const l=e.target;l.tagName==="INPUT"||l.tagName==="TEXTAREA"||l.isContentEditable||(e.key==="+"||e.key==="Add"||e.code==="NumpadAdd"||e.shiftKey&&(e.key==="="||e.code==="Equal"))&&K()},ue=e=>{q.value=e},ce=e=>{$.value=e,ne(),se()},me=e=>{B.value=e,pe(),ne(),se()},Ae=(e,l,o)=>{var n;const d=l.toLowerCase(),y=(n=o.raw.category_name)==null?void 0:n.toLowerCase(),v=o.raw.product_name.toLowerCase();return(y==null?void 0:y.includes(d))||v.includes(d)},Ne=(e,l)=>{const o=l.findIndex(d=>d.category_name===e.category_name&&d.product_name===e.product_name);return o===0||l[o-1].category_name!==e.category_name},Te=(e,l,o)=>{const d=l.toLowerCase(),y=o.raw.option_list_name.toLowerCase(),v=o.raw.name.toLowerCase();return y.includes(d)||v.includes(d)},Fe=(e,l)=>{const o=l.findIndex(d=>d.option_list_name===e.option_list_name&&d.name===e.name);return o===0||l[o-1].option_list_name!==e.option_list_name},Se=()=>{z.value=p.Api.HubrisePriceUtil.amountToPrice(0,I),new _e("minimum_order_value",void 0,l=>{var o;ae.value=l.setting,l.setting.strategy==="supplement"&&typeof((o=l.setting)==null?void 0:o.minimum)=="number"&&(z.value=p.Api.HubrisePriceUtil.amountToPrice(l.setting.minimum,I))}).loadSetting()},xe=()=>{new _e("delivery_fee",void 0,l=>{var o;le.value=l.setting,l.setting.type==="radius"&&Array.isArray((o=l.setting)==null?void 0:o.radiuses)&&l.setting.radiuses.forEach((d,y)=>{y===0&&d.amount===0&&(D.value=[]);const v=p.Api.HubrisePriceUtil.amountToPrice(d.amount,I);D.value.push({value:v,name:A(v)})})}).loadSetting()},w=e=>{G("nextField",e)},pe=()=>{b.value=[],P.value="",O.value="",T.value=L,H.value=!1,K()};return Oe(()=>j.reset,pe),De(()=>{window.addEventListener("keydown",de),J.onCurrentLocationChange(ue),Q.onCurrentCatalogChange(ce),Z.onCurrentVariantChange(me),Se(),xe()}),Ke(()=>{window.removeEventListener("keydown",de),J.offCurrentLocationChange(ue),Q.offCurrentCatalogChange(ce),Z.offCurrentVariantChange(me)}),(e,l)=>{const o=ze,d=Be,y=Re("IconBtn"),v=je;return g(),k(Ye,{disabled:!q.value||!$.value,loading:!q.value||!$.value},{default:a(()=>[t(Me,null,{default:a(()=>[c(u(("$t"in e?e.$t:s(m))("page.order.add.section.item.title")),1)]),_:1}),t(We,null,{default:a(()=>[t(V,{dense:""},{default:a(()=>[t(r,{cols:"2",md:"2"},{default:a(()=>[c(u(("$t"in e?e.$t:s(m))("page.order.add.section.item.reference")),1)]),_:1}),t(r,{cols:"2",md:"4"},{default:a(()=>[c(u(("$t"in e?e.$t:s(m))("page.order.add.section.item.name")),1)]),_:1}),t(r,{class:"text-center",cols:"2",md:"1"},{default:a(()=>[c(u(("$t"in e?e.$t:s(m))("page.order.add.section.item.quantity")),1)]),_:1}),t(r,{class:"text-center",cols:"2",md:"1"},{default:a(()=>[c(u(("$t"in e?e.$t:s(m))("page.order.add.section.item.vat")),1)]),_:1}),t(r,{class:"text-center",cols:"1",md:"1"},{default:a(()=>[c(u(("$t"in e?e.$t:s(m))("page.order.add.section.item.price")),1)]),_:1}),t(r,{class:"text-center",cols:"2",md:"2"},{default:a(()=>[c(u(("$t"in e?e.$t:s(m))("page.order.add.section.item.subtotal")),1)]),_:1}),t(r,{cols:"1",md:"1"})]),_:1}),(g(!0),x(M,null,ge(b.value,n=>(g(),x(M,{key:n.id},[t(V,{align:"center",dense:""},{default:a(()=>[t(r,{cols:"4",md:"2"},{default:a(()=>[n.sku_ref!==null?(g(),k(o,{key:0,modelValue:n.sku_ref,"onUpdate:modelValue":[i=>n.sku_ref=i,i=>re(i,n)],items:s(ee),placeholder:("$t"in e?e.$t:s(m))("page.order.add.section.item.reference"),"item-title":"sku_ref","item-value":"id","no-data-text":"common.component.noData",onKeyup:U(w,["enter"])},null,8,["modelValue","onUpdate:modelValue","items","placeholder"])):C("",!0)]),_:2},1024),t(r,{cols:"6",md:"4"},{default:a(()=>[t(o,{modelValue:n.product_name,"onUpdate:modelValue":[i=>n.product_name=i,i=>re(i,n)],"custom-filter":Ae,items:s(S),placeholder:("$t"in e?e.$t:s(m))("page.order.add.section.item.name"),"item-title":"product_name","item-value":"id","no-data-text":"common.component.noData",onKeyup:U(w,["enter"])},{item:a(({props:i,item:f})=>[E("div",Ge,[Ne(f.raw,s(S))?(g(),k(be,{key:0,class:"text-primary font-weight-bold"},{default:a(()=>[c(u(f.raw.category_name),1)]),_:2},1024)):C("",!0),t(he,ye({class:"ps-8",ref_for:!0},i),{default:a(()=>[t(Ce)]),_:2},1040)])]),selection:a(({item:i})=>[E("span",Je,u(i.title),1)]),_:2},1032,["modelValue","onUpdate:modelValue","items","placeholder"])]),_:2},1024),t(r,{class:"ps-1 pe-1",cols:"2",md:"1"},{default:a(()=>[n.quantity!==void 0?(g(),x("div",Qe,[t(F,{class:"align-self-end",icon:"bx-minus",size:"x-small",variant:"text",onClick:i=>n.quantity=Math.max(1,Number(n.quantity)-1)},null,8,["onClick"]),t(d,{modelValue:n.quantity,"onUpdate:modelValue":i=>n.quantity=i,clearable:!1,class:"no-arrows",min:"1",placeholder:"0",type:"number",onKeyup:U(w,["enter"])},null,8,["modelValue","onUpdate:modelValue"]),t(F,{class:"align-self-end",icon:"bx-plus",size:"x-small",variant:"text",onClick:i=>n.quantity=Number(n.quantity)+1},null,8,["onClick"])])):C("",!0)]),_:2},1024),t(r,{class:"align-self-end text-center",cols:"3",md:"1"},{default:a(()=>[c(u(oe(n.tax_rate)),1)]),_:2},1024),t(r,{class:"align-self-end text-center",cols:"3",md:"1"},{default:a(()=>[c(u(s(A)(n.price)),1)]),_:2},1024),t(r,{class:"align-self-end text-center",cols:"3",md:"2"},{default:a(()=>[c(u(s(A)(s(p.Api).HubrisePriceUtil.multiply(n.price,n.quantity))),1)]),_:2},1024),t(r,{class:"px-0 text-right",cols:"3",md:"1"},{default:a(()=>[t(y,{"x-small":"",onClick:i=>n.customer_notes=n.customer_notes===void 0?null:void 0},{default:a(()=>[t(W,{icon:"bx-edit"})]),_:2},1032,["onClick"]),t(y,{onClick:i=>we(n)},{default:a(()=>[t(W,{icon:"bx-trash"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024),(g(!0),x(M,null,ge(n.options,i=>(g(),x("div",{key:i.ref},[t(V,{align:"center",dense:""},{default:a(()=>[t(r,{class:"d-flex align-self-end",cols:"4",md:"2"},{default:a(()=>[t(X),i.ref!==null?(g(),k(o,{key:0,modelValue:i.ref,"onUpdate:modelValue":[f=>i.ref=f,f=>ie(n.id,f,i)],items:s(te)[n.id],placeholder:("$t"in e?e.$t:s(m))("page.order.add.section.item.reference"),"item-title":"ref","item-value":"id","no-data-text":"common.component.noData",onKeyup:U(w,["enter"])},null,8,["modelValue","onUpdate:modelValue","items","placeholder"])):C("",!0)]),_:2},1024),t(r,{class:"d-flex align-self-end",cols:"6",md:"4"},{default:a(()=>[t(X),t(o,{modelValue:i.name,"onUpdate:modelValue":[f=>i.name=f,f=>ie(n.id,f,i)],"custom-filter":Te,items:s(N)[n.id],placeholder:("$t"in e?e.$t:s(m))("page.order.add.section.item.name"),"item-title":"name","item-value":"id","no-data-text":"common.component.noData",onKeyup:U(w,["enter"])},{item:a(({props:f,item:ve})=>[E("div",Ze,[Fe(ve.raw,s(N)[n.id])?(g(),k(be,{key:0,class:"text-primary font-weight-bold"},{default:a(()=>[c(u(ve.raw.option_list_name),1)]),_:2},1024)):C("",!0),t(he,ye({class:"ps-8",ref_for:!0},f),{default:a(()=>[t(Ce)]),_:2},1040)])]),selection:a(({item:f})=>[E("span",et,u(f.title),1)]),_:2},1032,["modelValue","onUpdate:modelValue","items","placeholder"])]),_:2},1024),t(r,{class:"ps-1 pe-1",cols:"2",md:"1"},{default:a(()=>[i.quantity!==void 0?(g(),x("div",tt,[t(F,{class:"align-self-end",icon:"bx-minus",size:"x-small",variant:"text",onClick:f=>i.quantity=Math.max(1,Number(i.quantity)-1)},null,8,["onClick"]),t(d,{modelValue:i.quantity,"onUpdate:modelValue":f=>i.quantity=f,clearable:!1,class:"no-arrows",min:"1",placeholder:"0",type:"number",onKeyup:U(w,["enter"])},null,8,["modelValue","onUpdate:modelValue"]),t(F,{class:"align-self-end",icon:"bx-plus",size:"x-small",variant:"text",onClick:f=>i.quantity=Number(i.quantity)+1},null,8,["onClick"])])):C("",!0)]),_:2},1024),t(r,{class:"align-self-end text-center",cols:"3",md:"1"},{default:a(()=>[c(u(oe(n.tax_rate)),1)]),_:2},1024),t(r,{class:"align-self-end text-center",cols:"3",md:"1"},{default:a(()=>[c(u(s(A)(i.price)),1)]),_:2},1024),t(r,{class:"align-self-end text-center",cols:"3",md:"2"},{default:a(()=>[c(u(s(A)(s(p.Api).HubrisePriceUtil.multiply(i.price,i.quantity))),1)]),_:2},1024),t(r,{class:"px-0 text-right",cols:"3",md:"1"},{default:a(()=>[t(y,{onClick:f=>ke(n,i)},{default:a(()=>[t(W,{icon:"bx-trash"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]))),128)),t(V,{dense:""},{default:a(()=>[t(r,{cols:"0",md:"2"}),t(r,{cols:"12",md:"5"},{default:a(()=>{var i;return[((i=s(N)[n.id])==null?void 0:i.length)>0?(g(),k(F,{key:0,class:"mt-6",color:"secondary","prepend-icon":"bx-plus",size:"x-small",onClick:f=>Y(n)},{default:a(()=>[c(u(("$t"in e?e.$t:s(m))("page.order.add.section.item.button.add.itemOption")),1)]),_:2},1032,["onClick"])):C("",!0)]}),_:2},1024),t(r,{cols:"12",md:"4"},{default:a(()=>[n.customer_notes!==void 0?(g(),k(v,{key:0,modelValue:n.customer_notes,"onUpdate:modelValue":i=>n.customer_notes=i,label:("$t"in e?e.$t:s(m))("page.order.add.section.item.itemNotes"),placeholder:("$t"in e?e.$t:s(m))("page.order.add.section.item.itemNotes"),"auto-grow":"",counter:"",maxlength:"300",rows:"1",onKeyup:U(w,["enter"])},null,8,["modelValue","onUpdate:modelValue","label","placeholder"])):C("",!0)]),_:2},1024),t(r,{cols:"0",md:"1"})]),_:2},1024)],64))),128)),t(V,{dense:""},{default:a(()=>[t(r,{cols:"12"},{default:a(()=>[t(F,{class:"mt-6",color:"secondary","prepend-icon":"bx-plus",size:"small",onClick:K},{default:a(()=>[c(u(("$t"in e?e.$t:s(m))("page.order.add.section.item.button.add.item")),1)]),_:1})]),_:1}),t(r,{class:"px-4 py-8",cols:"6",md:"3"},{default:a(()=>[t(v,{modelValue:P.value,"onUpdate:modelValue":l[0]||(l[0]=n=>P.value=n),label:("$t"in e?e.$t:s(m))("page.order.add.section.item.customerNotes"),placeholder:("$t"in e?e.$t:s(m))("page.order.add.section.item.customerNotes"),"auto-grow":"",counter:"",maxlength:"500",rows:"4",onKeyup:U(w,["enter"])},null,8,["modelValue","label","placeholder"])]),_:1}),t(r,{class:"px-4 py-8",cols:"6",md:"3"},{default:a(()=>[t(X),t(v,{modelValue:O.value,"onUpdate:modelValue":l[1]||(l[1]=n=>O.value=n),label:("$t"in e?e.$t:s(m))("page.order.add.section.item.sellerNotes"),placeholder:("$t"in e?e.$t:s(m))("page.order.add.section.item.sellerNotes"),"auto-grow":"",counter:"",maxlength:"500",rows:"4",onKeyup:U(w,["enter"])},null,8,["modelValue","label","placeholder"])]),_:1}),t(r,{cols:"0",md:"1"}),t(r,{cols:"12",md:"5"},{default:a(()=>[t(V,{dense:""},{default:a(()=>[t(r,{class:"align-self-end",cols:"6",md:"5"},{default:a(()=>[c(u(("$t"in e?e.$t:s(m))("page.order.add.section.item.subtotal")),1)]),_:1}),t(r,{class:"text-center",cols:"6",md:"4"},{default:a(()=>[c(u(s(A)(s(h).subtotal)),1)]),_:1}),t(r,{cols:"0",md:"3"})]),_:1}),s(h).minimumOrderFee!==void 0&&R.serviceType===s(p.Api).HubriseServiceType.DELIVERY?(g(),k(V,{key:0,dense:""},{default:a(()=>[t(r,{class:"align-self-end",cols:"6",md:"5"},{default:a(()=>[c(u(("$t"in e?e.$t:s(m))("page.order.add.section.item.minimumOrderFee"))+" ",1),l[3]||(l[3]=E("br",null,null,-1)),c(" (â‰¤ "+u(z.value)+") ",1)]),_:1,__:[3]}),t(r,{class:"text-center",cols:"6",md:"4"},{default:a(()=>[c(u(s(A)(s(h).minimumOrderFee)),1)]),_:1}),t(r,{cols:"0",md:"3"})]),_:1})):C("",!0),R.serviceType===s(p.Api).HubriseServiceType.DELIVERY?(g(),k(V,{key:1,dense:""},{default:a(()=>[t(r,{class:"align-self-end",cols:"6",md:"5"},{default:a(()=>[c(u(("$t"in e?e.$t:s(m))("page.order.add.section.item.deliveryFee")),1)]),_:1}),t(r,{class:"text-center pa-0",cols:"6",md:"4"},{default:a(()=>[t(Xe,{modelValue:T.value,"onUpdate:modelValue":l[2]||(l[2]=n=>T.value=n),items:D.value,loading:D.value.length===0,class:"d-inline-flex","item-title":"name","item-value":"value",variant:"plain"},null,8,["modelValue","items","loading"])]),_:1}),t(r,{cols:"0",md:"3"})]),_:1})):C("",!0),t(V,{dense:""},{default:a(()=>[t(r,{class:"align-self-end",cols:"6",md:"5"},{default:a(()=>[c(u(("$t"in e?e.$t:s(m))("page.order.add.section.item.total")),1)]),_:1}),t(r,{class:"text-center",cols:"6",md:"4"},{default:a(()=>[c(u(s(A)(s(h).total)),1)]),_:1}),t(r,{cols:"0",md:"3"})]),_:1}),t(V,{dense:""},{default:a(()=>[t(r,{cols:"12",md:"9"},{default:a(()=>[t(F,{disabled:$e(),loading:H.value,class:"w-100",onClick:Ue},{default:a(()=>[c(u(("$t"in e?e.$t:s(m))("page.order.add.button.create")),1)]),_:1},8,["disabled","loading"])]),_:1}),t(r,{cols:"0",md:"3"})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["disabled","loading"])}}});export{vt as _};
