import{d as Q,bj as W,dR as Z,r as z,X as M,G as ee,aj as te,c as w,b as o,e as m,f as l,m as n,ai as S,aN as s,o as b,v as r,t as c,$ as ae,F as oe,i as le,g as O,l as I}from"./index-BZ3aEYCE.js";import{_ as ne}from"./AppSelect.vue_vue_type_script_setup_true_lang-D7ZTkFUk.js";import{_ as se}from"./AppTextField.vue_vue_type_script_setup_true_lang-DBLl0f7O.js";import{c as p}from"./common-api.web.min-DozRe4br.js";import{d as re}from"./PriceUtil-D0mOL2d2.js";import{L as ie}from"./LocationSettingService-D2KVaXbD.js";import{V,a as d}from"./VRow-Dy4_d2Ns.js";import{V as de}from"./VCard-CFHeageg.js";import{V as ue}from"./VCardText-DtWLqdWo.js";import{V as P}from"./VSwitch-DIFcdpLP.js";import{V as f}from"./VRangeSlider-BtM2Sdbi.js";const me={class:"d-flex align-center justify-space-between"},pe={class:"text-h6 font-weight-medium"},ce={class:"mb-0"},ge={class:"text-caption"},be={class:"text-caption mb-1"},fe={class:"text-caption mb-1"},he={class:"text-caption mb-1"},Ve={class:"text-caption mb-1"},$e={class:"text-caption mb-1"},_e={class:"pt-5 text-right"},T=20,U=1e3,G=1e3,k=-60,N=-12,Le=Q({__name:"setting-group",emits:["done"],setup(ye,{emit:H}){var D;const F=H,j=((D=W().getCurrentAccount)==null?void 0:D.currency)??p.Api.HubriseCurrencyCode.EUR,B=Z(),A=z(!1),u=z([]),Y=[{title:"Delivery",value:p.Api.HubriseServiceType.DELIVERY},{title:"Pickup",value:p.Api.HubriseServiceType.COLLECTION},{title:"Eat-In",value:p.Api.HubriseServiceType.EAT_IN}],$=new ie("smsmode_customer_groups",A,e=>{var i;Array.isArray(e.setting.groups)?u.value=e.setting.groups:L(p.Util.StringUtil.slugify(((i=B.getCurrentLocation)==null?void 0:i.name)??"all"))}),L=e=>{u.value.length<20&&u.value.push({id:String(Date.now()),name:e,zipCodes:void 0,orderCountRange:[0,T],totalSpentRange:[0,U],loyaltyPointsRange:[0,G],firstOrderDateRange:[k,0],lastOrderDateRange:[N,0],lastOrderServiceTypes:[p.Api.HubriseServiceType.DELIVERY,p.Api.HubriseServiceType.COLLECTION,p.Api.HubriseServiceType.EAT_IN],smsMarketingOptIn:!0})},X=e=>{u.value.length>1&&(u.value=u.value.filter(i=>i.id!==e))},q=e=>{e.name=p.Util.StringUtil.slugify(e.name,"-")},x=(e,i)=>!e||e.trim().length===0?s("page.customerGroup.group.groupName.required"):e.trim()!==e?s("page.customerGroup.group.groupName.noSpaces"):/^[a-z0-9\-]+$/i.test(e)?u.value.find(h=>h.id!==i&&h.name.toLowerCase()===e.toLowerCase())?s("page.customerGroup.group.groupName.duplicate"):!0:s("page.customerGroup.group.groupName.invalidChars"),E=M(()=>{const e={};return u.value.forEach(i=>{const g=x(i.name,i.id);g!==!0&&(e[i.id]=g)}),e}),J=M(()=>Object.keys(E.value).length===0),_=e=>e===T?`${e}+`:`${e}`,y=e=>e===G?`${e}+`:`${e}`,v=e=>`${re(p.Api.HubrisePriceUtil.amountToPrice(e,j),!0,!0)}${e===U?"+":""}`,C=e=>e===0?"Now":`${Math.abs(e)}${e===k?"+":""} month${Math.abs(e)>1?"s":""} ago`,R=e=>e===0?"Now":`${Math.abs(e)}${e===N?"+":""} month${Math.abs(e)>1?"s":""} ago`,K=()=>{$.saveSetting({groups:u.value}).then(()=>F("done"))};return ee(()=>{$.start()}),te(()=>{$.stop()}),(e,i)=>{const g=se,h=ne;return b(),w("div",null,[o(V,null,{default:l(()=>[o(d,{cols:"12"},{default:l(()=>[m("div",me,[m("div",null,[m("h6",pe,r(("$t"in e?e.$t:n(s))("page.customerGroup.group.title")),1),m("p",ce,r(("$t"in e?e.$t:n(s))("page.customerGroup.group.subtitle")),1)]),o(S,{disabled:n(u).length>=10,color:"primary",variant:"tonal",onClick:i[0]||(i[0]=t=>L(""))},{default:l(()=>[o(ae,{icon:"bx-plus",start:""}),c(" "+r(("$t"in e?e.$t:n(s))("page.customerGroup.group.addGroup")),1)]),_:1},8,["disabled"])])]),_:1}),o(d,{cols:"12"},{default:l(()=>[o(V,null,{default:l(()=>[(b(!0),w(oe,null,le(n(u),t=>(b(),O(d,{key:t.id,cols:"12"},{default:l(()=>[o(de,{variant:"outlined"},{default:l(()=>[o(ue,null,{default:l(()=>[o(V,null,{default:l(()=>[o(d,{cols:"8",md:"4"},{default:l(()=>[o(g,{modelValue:t.name,"onUpdate:modelValue":[a=>t.name=a,a=>q(t)],"error-messages":n(E)[t.id]||"",label:("$t"in e?e.$t:n(s))("page.customerGroup.group.groupName.label"),density:"compact"},null,8,["modelValue","onUpdate:modelValue","error-messages","label"])]),_:2},1024),o(d,{class:"text-right",cols:"4",md:"8"},{default:l(()=>[n(u).length>1?(b(),O(S,{key:0,color:"error",icon:"bx-trash",size:"small",variant:"text",onClick:a=>X(t.id)},null,8,["onClick"])):I("",!0)]),_:2},1024)]),_:2},1024),o(V,null,{default:l(()=>[o(d,{cols:"12",md:"4"},{default:l(()=>[m("div",ge,r(("$t"in e?e.$t:n(s))("page.customerGroup.group.marketing.optIn")),1),o(P,{modelValue:t.smsMarketingOptIn,"onUpdate:modelValue":a=>t.smsMarketingOptIn=a,label:("$t"in e?e.$t:n(s))("page.customerGroup.group.marketing.smsMarketing"),density:"compact","hide-details":""},null,8,["modelValue","onUpdate:modelValue","label"])]),_:2},1024),o(d,{cols:"12",md:"4"},{default:l(()=>[m("div",be,r(("$t"in e?e.$t:n(s))("page.customerGroup.group.orderCount.label",{min:_(t.orderCountRange[0]),max:_(t.orderCountRange[1])})),1),o(f,{modelValue:t.orderCountRange,"onUpdate:modelValue":a=>t.orderCountRange=a,max:T,min:0,"thumb-size":18,"tick-size":3,"show-ticks":"",step:"1","thumb-label":""},{"thumb-label":l(({modelValue:a})=>[c(r(_(a)),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(d,{cols:"12",md:"4"},{default:l(()=>[m("div",fe,r(("$t"in e?e.$t:n(s))("page.customerGroup.group.totalSpent.label",{min:v(t.totalSpentRange[0]),max:v(t.totalSpentRange[1])})),1),o(f,{modelValue:t.totalSpentRange,"onUpdate:modelValue":a=>t.totalSpentRange=a,max:U,min:0,"thumb-size":18,step:"1","thumb-label":""},{"thumb-label":l(({modelValue:a})=>[c(r(v(a)),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(d,{cols:"12",md:"4"},{default:l(()=>[m("div",he,r(("$t"in e?e.$t:n(s))("page.customerGroup.group.loyaltyPoints.label",{min:y(t.loyaltyPointsRange[0]),max:y(t.loyaltyPointsRange[1])})),1),o(f,{modelValue:t.loyaltyPointsRange,"onUpdate:modelValue":a=>t.loyaltyPointsRange=a,max:G,min:0,"thumb-size":18,step:"1","thumb-label":""},{"thumb-label":l(({modelValue:a})=>[c(r(y(a)),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(d,{cols:"12",md:"4"},{default:l(()=>[m("div",Ve,r(("$t"in e?e.$t:n(s))("page.customerGroup.group.firstOrder.label",{min:C(t.firstOrderDateRange[0]),max:C(t.firstOrderDateRange[1])})),1),o(f,{modelValue:t.firstOrderDateRange,"onUpdate:modelValue":a=>t.firstOrderDateRange=a,max:0,min:k,"thumb-size":18,step:"1","thumb-label":""},{"thumb-label":l(({modelValue:a})=>[c(r(C(a)),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(d,{cols:"12",md:"4"},{default:l(()=>[m("div",$e,r(("$t"in e?e.$t:n(s))("page.customerGroup.group.lastOrder.label",{min:R(t.lastOrderDateRange[0]),max:R(t.lastOrderDateRange[1])})),1),o(f,{modelValue:t.lastOrderDateRange,"onUpdate:modelValue":a=>t.lastOrderDateRange=a,max:0,min:N,"thumb-size":18,"tick-size":3,"show-ticks":"",step:"1","thumb-label":""},{"thumb-label":l(({modelValue:a})=>[c(r(R(a)),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(d,{cols:"12",md:"5"},{default:l(()=>[o(h,{modelValue:t.lastOrderServiceTypes,"onUpdate:modelValue":a=>t.lastOrderServiceTypes=a,items:Y,label:("$t"in e?e.$t:n(s))("page.customerGroup.group.serviceType.label"),chips:"","closable-chips":"",multiple:"",style:{"min-width":"100%"}},null,8,["modelValue","onUpdate:modelValue","label"])]),_:2},1024),o(d,{class:"d-inline-flex align-items-center justify-space-between gap-4 align-center",cols:"12",md:"7"},{default:l(()=>[o(P,{label:("$t"in e?e.$t:n(s))("page.customerGroup.group.zipCodes.label"),class:"d-inline-block align-baseline",density:"compact","hide-details":"",onClick:a=>t.zipCodes=t.zipCodes===void 0?"":void 0},null,8,["label","onClick"]),t.zipCodes!==void 0?(b(),O(g,{key:0,modelValue:t.zipCodes,"onUpdate:modelValue":a=>t.zipCodes=a,label:("$t"in e?e.$t:n(s))("page.customerGroup.group.zipCodes.placeholder"),placeholder:("$t"in e?e.$t:n(s))("page.customerGroup.group.zipCodes.example"),class:"d-inline-block align-baseline",density:"compact"},null,8,["modelValue","onUpdate:modelValue","label","placeholder"])):I("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),m("div",_e,[o(S,{disabled:!n(J),loading:n(A),variant:"tonal",onClick:K},{default:l(()=>[c(r(("$t"in e?e.$t:n(s))("page.customerGroup.group.button.next")),1)]),_:1},8,["disabled","loading"])])])}}});export{Le as _};
