import{d as Z,bj as ee,dR as te,r as z,X as w,G as ae,aj as oe,c as I,b as o,e as m,f as l,m as r,ai as S,aN as n,o as b,v as s,t as c,$ as le,F as ne,i as re,g as O,l as M}from"./index-s-FC0fWQ.js";import{_ as se}from"./AppSelect.vue_vue_type_script_setup_true_lang-COImj50U.js";import{_ as ie}from"./AppTextField.vue_vue_type_script_setup_true_lang-qvfA_4Y4.js";import{c as p}from"./common-api.web.min-DozRe4br.js";import{d as de}from"./PriceUtil-CN6QPl_t.js";import{L as ue}from"./LocationSettingService-3CHG08G0.js";import{V,a as d}from"./VRow-C9MFR679.js";import{V as me}from"./VCard-cZ1TbrGe.js";import{V as pe}from"./VCardText-2Hqilpq8.js";import{V as P}from"./VSwitch-KlGjUIJW.js";import{V as f}from"./VRangeSlider-QKBAK-45.js";const ce={class:"d-flex align-center justify-space-between"},ge={class:"text-h6 font-weight-medium"},be={class:"mb-0"},fe={class:"text-caption"},he={class:"text-caption mb-1"},Ve={class:"text-caption mb-1"},$e={class:"text-caption mb-1"},ye={class:"text-caption mb-1"},_e={class:"text-caption mb-1"},ve={class:"pt-5 text-right"},T=20,U=1e3,G=1e3,k=-60,A=-12,Ee=Z({__name:"setting-group",props:{appKey:{type:String,required:!0},appName:{type:String,required:!0}},emits:["done"],setup(H,{emit:F}){var D;const j=H,B=F,Y=((D=ee().getCurrentAccount)==null?void 0:D.currency)??p.Api.HubriseCurrencyCode.EUR,X=te(),N=z(!1),u=z([]),q=[{title:"Delivery",value:p.Api.HubriseServiceType.DELIVERY},{title:"Pickup",value:p.Api.HubriseServiceType.COLLECTION},{title:"Eat-In",value:p.Api.HubriseServiceType.EAT_IN}],$=new ue(`${j.appKey}_customer_groups`,N,e=>{var i;Array.isArray(e.setting.groups)?u.value=e.setting.groups:L(p.Util.StringUtil.slugify(((i=X.getCurrentLocation)==null?void 0:i.name)??"all"))}),L=e=>{u.value.length<20&&u.value.push({id:String(Date.now()),name:e,zipCodes:void 0,orderCountRange:[0,T],totalSpentRange:[0,U],loyaltyPointsRange:[0,G],firstOrderDateRange:[k,0],lastOrderDateRange:[A,0],lastOrderServiceTypes:[p.Api.HubriseServiceType.DELIVERY,p.Api.HubriseServiceType.COLLECTION,p.Api.HubriseServiceType.EAT_IN],smsMarketingOptIn:!0})},K=e=>{u.value.length>1&&(u.value=u.value.filter(i=>i.id!==e))},x=e=>{e.name=p.Util.StringUtil.slugify(e.name,"-")},J=(e,i)=>!e||e.trim().length===0?n("page.customerGroup.group.groupName.required"):e.trim()!==e?n("page.customerGroup.group.groupName.noSpaces"):/^[a-z0-9\-]+$/i.test(e)?u.value.find(h=>h.id!==i&&h.name.toLowerCase()===e.toLowerCase())?n("page.customerGroup.group.groupName.duplicate"):!0:n("page.customerGroup.group.groupName.invalidChars"),E=w(()=>{const e={};return u.value.forEach(i=>{const g=J(i.name,i.id);g!==!0&&(e[i.id]=g)}),e}),Q=w(()=>Object.keys(E.value).length===0),y=e=>e===T?`${e}+`:`${e}`,_=e=>e===G?`${e}+`:`${e}`,v=e=>`${de(p.Api.HubrisePriceUtil.amountToPrice(e,Y),!0,!0)}${e===U?"+":""}`,C=e=>e===0?n("common.time.now"):n("common.time.period.monthAgo",{month:`${Math.abs(e)}${e===k?"+":""}`}),R=e=>e===0?n("common.time.now"):n("common.time.period.monthAgo",{month:`${Math.abs(e)}${e===A?"+":""}`}),W=()=>{$.saveSetting({groups:u.value}).then(()=>B("done"))};return ae(()=>{$.start()}),oe(()=>{$.stop()}),(e,i)=>{const g=ie,h=se;return b(),I("div",null,[o(V,null,{default:l(()=>[o(d,{cols:"12"},{default:l(()=>[m("div",ce,[m("div",null,[m("h6",ge,s(("$t"in e?e.$t:r(n))("page.customerGroup.group.title")),1),m("p",be,s(("$t"in e?e.$t:r(n))("page.customerGroup.group.subtitle")),1)]),o(S,{disabled:r(u).length>=10,color:"primary",variant:"tonal",onClick:i[0]||(i[0]=t=>L(""))},{default:l(()=>[o(le,{icon:"bx-plus",start:""}),c(" "+s(("$t"in e?e.$t:r(n))("page.customerGroup.group.addGroup")),1)]),_:1},8,["disabled"])])]),_:1}),o(d,{cols:"12"},{default:l(()=>[o(V,null,{default:l(()=>[(b(!0),I(ne,null,re(r(u),t=>(b(),O(d,{key:t.id,cols:"12"},{default:l(()=>[o(me,{variant:"outlined"},{default:l(()=>[o(pe,null,{default:l(()=>[o(V,null,{default:l(()=>[o(d,{cols:"8",md:"4"},{default:l(()=>[o(g,{modelValue:t.name,"onUpdate:modelValue":[a=>t.name=a,a=>x(t)],"error-messages":r(E)[t.id]||"",label:("$t"in e?e.$t:r(n))("page.customerGroup.group.groupName.label"),density:"compact"},null,8,["modelValue","onUpdate:modelValue","error-messages","label"])]),_:2},1024),o(d,{class:"text-right",cols:"4",md:"8"},{default:l(()=>[r(u).length>1?(b(),O(S,{key:0,color:"error",icon:"bx-trash",size:"small",variant:"text",onClick:a=>K(t.id)},null,8,["onClick"])):M("",!0)]),_:2},1024)]),_:2},1024),o(V,null,{default:l(()=>[o(d,{cols:"12",md:"4"},{default:l(()=>[m("div",fe,s(("$t"in e?e.$t:r(n))("page.customerGroup.group.marketing.optIn")),1),o(P,{modelValue:t.smsMarketingOptIn,"onUpdate:modelValue":a=>t.smsMarketingOptIn=a,label:("$t"in e?e.$t:r(n))("page.customerGroup.group.marketing.smsMarketing"),density:"compact","hide-details":""},null,8,["modelValue","onUpdate:modelValue","label"])]),_:2},1024),o(d,{cols:"12",md:"4"},{default:l(()=>[m("div",he,s(("$t"in e?e.$t:r(n))("page.customerGroup.group.orderCount.label",{min:y(t.orderCountRange[0]),max:y(t.orderCountRange[1])})),1),o(f,{modelValue:t.orderCountRange,"onUpdate:modelValue":a=>t.orderCountRange=a,max:T,min:0,"thumb-size":18,"tick-size":3,"show-ticks":"",step:"1","thumb-label":""},{"thumb-label":l(({modelValue:a})=>[c(s(y(a)),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(d,{cols:"12",md:"4"},{default:l(()=>[m("div",Ve,s(("$t"in e?e.$t:r(n))("page.customerGroup.group.totalSpent.label",{min:v(t.totalSpentRange[0]),max:v(t.totalSpentRange[1])})),1),o(f,{modelValue:t.totalSpentRange,"onUpdate:modelValue":a=>t.totalSpentRange=a,max:U,min:0,"thumb-size":18,step:"1","thumb-label":""},{"thumb-label":l(({modelValue:a})=>[c(s(v(a)),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(d,{cols:"12",md:"4"},{default:l(()=>[m("div",$e,s(("$t"in e?e.$t:r(n))("page.customerGroup.group.loyaltyPoints.label",{min:_(t.loyaltyPointsRange[0]),max:_(t.loyaltyPointsRange[1])})),1),o(f,{modelValue:t.loyaltyPointsRange,"onUpdate:modelValue":a=>t.loyaltyPointsRange=a,max:G,min:0,"thumb-size":18,step:"1","thumb-label":""},{"thumb-label":l(({modelValue:a})=>[c(s(_(a)),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(d,{cols:"12",md:"4"},{default:l(()=>[m("div",ye,s(("$t"in e?e.$t:r(n))("page.customerGroup.group.firstOrder.label",{min:C(t.firstOrderDateRange[0]),max:C(t.firstOrderDateRange[1])})),1),o(f,{modelValue:t.firstOrderDateRange,"onUpdate:modelValue":a=>t.firstOrderDateRange=a,max:0,min:k,"thumb-size":18,step:"1","thumb-label":""},{"thumb-label":l(({modelValue:a})=>[c(s(C(a)),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(d,{cols:"12",md:"4"},{default:l(()=>[m("div",_e,s(("$t"in e?e.$t:r(n))("page.customerGroup.group.lastOrder.label",{min:R(t.lastOrderDateRange[0]),max:R(t.lastOrderDateRange[1])})),1),o(f,{modelValue:t.lastOrderDateRange,"onUpdate:modelValue":a=>t.lastOrderDateRange=a,max:0,min:A,"thumb-size":18,"tick-size":3,"show-ticks":"",step:"1","thumb-label":""},{"thumb-label":l(({modelValue:a})=>[c(s(R(a)),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(d,{cols:"12",md:"5"},{default:l(()=>[o(h,{modelValue:t.lastOrderServiceTypes,"onUpdate:modelValue":a=>t.lastOrderServiceTypes=a,items:q,label:("$t"in e?e.$t:r(n))("page.customerGroup.group.serviceType.label"),chips:"","closable-chips":"",multiple:"",style:{"min-width":"100%"}},null,8,["modelValue","onUpdate:modelValue","label"])]),_:2},1024),o(d,{class:"d-inline-flex align-items-center justify-space-between gap-4 align-center",cols:"12",md:"7"},{default:l(()=>[o(P,{label:("$t"in e?e.$t:r(n))("page.customerGroup.group.zipCodes.label"),class:"d-inline-block align-baseline",density:"compact","hide-details":"",onClick:a=>t.zipCodes=t.zipCodes===void 0?"":void 0},null,8,["label","onClick"]),t.zipCodes!==void 0?(b(),O(g,{key:0,modelValue:t.zipCodes,"onUpdate:modelValue":a=>t.zipCodes=a,label:("$t"in e?e.$t:r(n))("page.customerGroup.group.zipCodes.placeholder"),placeholder:("$t"in e?e.$t:r(n))("page.customerGroup.group.zipCodes.example"),class:"d-inline-block align-baseline",density:"compact"},null,8,["modelValue","onUpdate:modelValue","label","placeholder"])):M("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),m("div",ve,[o(S,{disabled:!r(Q),loading:r(N),variant:"tonal",onClick:W},{default:l(()=>[c(s(("$t"in e?e.$t:r(n))("page.customerGroup.group.button.next")),1)]),_:1},8,["disabled","loading"])])])}}});export{Ee as _};
