import{bg as u,ci as p,cj as C,ck as L,b3 as d}from"./index-CiwEqhLZ.js";import{m as c}from"./mitt-DJ65BbbF.js";import{u as E}from"./account-DvQtffyR.js";import{$ as r}from"./TranslationUtil-YrEf8DfR.js";import{u as w}from"./alert-CIf1_c1a.js";const h=()=>typeof window.navigator!="object"||typeof window.navigator.onLine!="boolean"?!0:window.navigator.onLine,g=()=>typeof document.hidden=="boolean"?document.hidden:typeof document.msHidden=="boolean"?document.msHidden:typeof document.webkitHidden=="boolean"?document.webkitHidden:!1,m=c(),y=u("userStore",{state:()=>({user:void 0}),getters:{getCurrentUser:t=>t.user},actions:{onCurrentUserChange(t){m.on("update:user",t),t(this.user)},offCurrentUserChange(t){m.off("update:user",t)},setCurrentUser(t){this.user=t,m.emit("update:user",this.user)},reset(){this.user=void 0,m.emit("update:user",this.user)}},persist:!0}),a=c(),S=u("locationStore",{state:()=>({location:void 0,locations:void 0}),getters:{getCurrentLocation:t=>t.location,getLocations:t=>t.locations},actions:{onCurrentLocationChange(t){a.on("update:location",t),t(this.location)},offCurrentLocationChange(t){a.off("update:location",t)},onLocationsChange(t){a.on("update:locations",t),t(this.locations)},offLocationsChange(t){a.off("update:locations",t)},setCurrentLocation(t){this.location=t,a.emit("update:location",this.location)},setLocations(t){this.locations=t,a.emit("update:locations",this.locations)},reset(){this.location=void 0,a.emit("update:location",this.location),this.locations=void 0,a.emit("update:locations",this.locations)}},persist:!0}),o=c(),b=u("customerListStore",{state:()=>({customerList:void 0,customerLists:void 0}),getters:{getCurrentCustomerList:t=>t.customerList,getCustomerLists:t=>t.customerLists},actions:{onCurrentCustomerListChange(t){o.on("update:customerList",t),t(this.customerList)},offCurrentCustomerListChange(t){o.off("update:customerList",t)},onCustomerListsChange(t){o.on("update:customerLists",t),t(this.customerLists)},offCustomerListsChange(t){o.off("update:customerLists",t)},setCurrentCustomerList(t){this.customerList=t,o.emit("update:customerList",this.customerList)},setCustomerLists(t){this.customerLists=t,o.emit("update:customerLists",this.customerLists)},reset(){this.customerList=void 0,o.emit("update:customerList",this.customerList),this.customerLists=void 0,o.emit("update:customerLists",this.customerLists)}},persist:!0}),i=c(),V=u("catalogStore",{state:()=>({catalog:void 0,catalogs:void 0}),getters:{getCurrentCatalog:t=>t.catalog,getCatalogs:t=>t.catalogs},actions:{onCurrentCatalogChange(t){i.on("update:catalog",t),t(this.catalog)},offCurrentCatalogChange(t){i.off("update:catalog",t)},onCatalogsChange(t){i.on("update:catalogs",t),t(this.catalogs)},offCatalogsChange(t){i.off("update:catalogs",t)},setCurrentCatalog(t){this.catalog=t,i.emit("update:catalog",this.catalog)},setCatalogs(t){this.catalogs=t,i.emit("update:catalogs",this.catalogs)},reset(){this.catalog=void 0,i.emit("update:catalog",this.catalog),this.catalogs=void 0,i.emit("update:catalogs",this.catalogs)}},persist:!0}),n=c(),x=u("variantStore",{state:()=>({variant:void 0,variants:void 0}),getters:{getCurrentVariant:t=>t.variant===void 0?{ref:"0",name:r("page.order.add.button.variant.default")}:t.variant,getVariants:t=>t.variants},actions:{onCurrentVariantChange(t){n.on("update:variant",t),t(this.variant)},offCurrentVariantChange(t){n.off("update:variant",t)},onVariantsChange(t){n.on("update:variants",t),t(this.variants)},offVariantsChange(t){n.off("update:variants",t)},setCurrentVariant(t){this.variant=t,n.emit("update:variant",this.variant)},setVariants(t){var s;this.variants=Array.isArray(t)&&t.length>0?[{ref:"0",name:r("page.order.add.button.variant.default")}].concat(t):[],n.emit("update:variants",this.variants);const e=this.variant;e!==void 0&&((s=this.variants)==null?void 0:s.find(l=>l.ref===e.ref))===void 0&&this.setCurrentVariant(void 0)},setVariantsFromCatalog(t){var e;this.setVariants(((e=t==null?void 0:t.data)==null?void 0:e.variants)??[])},reset(){this.variant=void 0,n.emit("update:variant",this.variant),this.variants=void 0,n.emit("update:variants",this.variants)}},persist:!0});class v{static info(e,s){p(l=>{l.setExtra("context",Object.assign({isOnline:h(),isHidden:g()},s)),C(e)})}static exception(e){if(g()&&e.message!==void 0&&e.message!==null&&typeof e.message=="string"&&e.message.includes("timeout")||e.message!==void 0&&e.message!==null&&typeof e.message=="string"&&e.message.includes("status code 401"))return!1;p(s=>{s.setExtra("context",{isOnline:h(),isHidden:g()}),L(e)})}}const A=()=>{E().reset(),y().reset(),S().reset(),b().reset(),V().reset(),x().reset()},H=async(t,e)=>{d("jwt",{domain:".apps.onylab.com"}).value=null,d("accessToken").value=null,d("userData").value=null,d("userAbilityRules").value=null,A(),t!==void 0?await t.push("/login"):window.location.href="/",e!==void 0&&e.update([])},f=t=>(w().setAlert({title:t}),t),k=(t,e)=>!h()||typeof t.message=="string"&&t.message.includes("Network Error")?f(r("common.error.offline")):typeof t.message=="string"&&t.message.includes("timeout")?f(r("common.error.timeout")):(v.exception(t),f(r("common.error.default"))),M=async(t,e)=>{if(t.status===401){H().catch(v.exception);return}const s=new Error(t._data.message??"Request failed");return k(s)};export{k as a,S as b,A as c,b as d,V as e,x as f,M as h,H as l,y as u};
