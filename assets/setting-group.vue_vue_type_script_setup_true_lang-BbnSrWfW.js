import{_ as K}from"./AppSelect.vue_vue_type_script_setup_true_lang-pyzNSws8.js";import{_ as Q}from"./AppTextField.vue_vue_type_script_setup_true_lang-BX072sDt.js";import{c as m}from"./common-api.web.min-DozRe4br.js";import{d as W}from"./PriceUtil-D6qii6c8.js";import{d as Z,bj as ee,dR as te,r as $,X as w,G as ae,aj as le,c as D,b as l,e as d,f as s,m as p,ai as S,o as f,t as c,$ as se,F as oe,i as ne,g as O,l as z,v as n}from"./index-FiZtEeg0.js";import{L as ie}from"./LocationSettingService-B_A_u-zY.js";import{V,a as i}from"./VRow-CmycF_d-.js";import{V as re}from"./VCard-yUKpbj9D.js";import{V as de}from"./VCardText-W7YWonVw.js";import{V as I}from"./VSwitch-0s1HEcZQ.js";import{V as _}from"./VRangeSlider-BXOtcieE.js";const me={class:"d-flex align-center justify-space-between"},ce={class:"text-caption mb-1"},ue={class:"text-caption mb-1"},pe={class:"text-caption mb-1"},fe={class:"text-caption mb-1"},_e={class:"text-caption mb-1"},be={class:"pt-5 text-right"},T=20,x=1e3,U=1e3,A=-60,k=-12,Ae=Z({__name:"setting-group",emits:["done"],setup(Ve,{emit:P}){var M;const G=P,H=((M=ee().getCurrentAccount)==null?void 0:M.currency)??m.Api.HubriseCurrencyCode.EUR,F=te(),L=$(!1),r=$([]),j=[{title:"Delivery",value:m.Api.HubriseServiceType.DELIVERY},{title:"Pickup",value:m.Api.HubriseServiceType.COLLECTION},{title:"Eat-In",value:m.Api.HubriseServiceType.EAT_IN}],h=new ie("smsmode_customer_groups",L,e=>{var o;Array.isArray(e.setting.groups)?r.value=e.setting.groups:N(m.Util.StringUtil.slugify(((o=F.getCurrentLocation)==null?void 0:o.name)??"all"))}),N=e=>{r.value.length<20&&r.value.push({id:String(Date.now()),name:e,zipCodes:void 0,orderCountRange:[0,T],totalSpentRange:[0,x],loyaltyPointsRange:[0,U],firstOrderDateRange:[A,0],lastOrderDateRange:[k,0],lastOrderServiceTypes:[m.Api.HubriseServiceType.DELIVERY,m.Api.HubriseServiceType.COLLECTION,m.Api.HubriseServiceType.EAT_IN],smsMarketingOptIn:!0})},B=e=>{r.value.length>1&&(r.value=r.value.filter(o=>o.id!==e))},Y=e=>{e.name=m.Util.StringUtil.slugify(e.name,"-")},X=(e,o)=>!e||e.trim().length===0?"Group name is required":e.trim()!==e?"Group name cannot have leading or trailing spaces":/^[a-z0-9\-]+$/i.test(e)?r.value.find(b=>b.id!==o&&b.name.toLowerCase()===e.toLowerCase())?"A group with this name already exists":!0:"Only letters, numbers and dashes are allowed",E=w(()=>{const e={};return r.value.forEach(o=>{const u=X(o.name,o.id);u!==!0&&(e[o.id]=u)}),e}),q=w(()=>Object.keys(E.value).length===0),y=e=>e===T?`${e}+`:`${e}`,g=e=>e===U?`${e}+`:`${e}`,v=e=>`${W(m.Api.HubrisePriceUtil.amountToPrice(e,H),!0,!0)}${e===x?"+":""}`,R=e=>e===0?"Now":`${Math.abs(e)}${e===A?"+":""} month${Math.abs(e)>1?"s":""} ago`,C=e=>e===0?"Now":`${Math.abs(e)}${e===k?"+":""} month${Math.abs(e)>1?"s":""} ago`,J=()=>{h.saveSetting({groups:r.value}).then(()=>G("done"))};return ae(()=>{h.start()}),le(()=>{h.stop()}),(e,o)=>{const u=Q,b=K;return f(),D("div",null,[l(V,null,{default:s(()=>[l(i,{cols:"12"},{default:s(()=>[d("div",me,[o[2]||(o[2]=d("div",null,[d("h6",{class:"text-h6 font-weight-medium"}," Customer Groups "),d("p",{class:"mb-0"}," Manage your customer groups for smsmode ")],-1)),l(S,{disabled:p(r).length>=10,color:"primary",variant:"tonal",onClick:o[0]||(o[0]=t=>N(""))},{default:s(()=>[l(se,{icon:"bx-plus",start:""}),o[1]||(o[1]=c(" Add Group "))]),_:1,__:[1]},8,["disabled"])])]),_:1}),l(i,{cols:"12"},{default:s(()=>[l(V,null,{default:s(()=>[(f(!0),D(oe,null,ne(p(r),t=>(f(),O(i,{key:t.id,cols:"12"},{default:s(()=>[l(re,{variant:"outlined"},{default:s(()=>[l(de,null,{default:s(()=>[l(V,null,{default:s(()=>[l(i,{cols:"8",md:"4"},{default:s(()=>[l(u,{modelValue:t.name,"onUpdate:modelValue":[a=>t.name=a,a=>Y(t)],"error-messages":p(E)[t.id]||"",density:"compact",label:"Group Name (only lowercase letters, numbers and dashes)"},null,8,["modelValue","onUpdate:modelValue","error-messages"])]),_:2},1024),l(i,{class:"text-right",cols:"4",md:"8"},{default:s(()=>[p(r).length>1?(f(),O(S,{key:0,color:"error",icon:"bx-trash",size:"small",variant:"text",onClick:a=>B(t.id)},null,8,["onClick"])):z("",!0)]),_:2},1024)]),_:2},1024),l(V,null,{default:s(()=>[l(i,{cols:"12",md:"4"},{default:s(()=>[o[3]||(o[3]=d("div",{class:"text-caption"}," Marketing opt-in ",-1)),l(I,{modelValue:t.smsMarketingOptIn,"onUpdate:modelValue":a=>t.smsMarketingOptIn=a,density:"compact","hide-details":"",label:"SMS marketing"},null,8,["modelValue","onUpdate:modelValue"])]),_:2,__:[3]},1024),l(i,{cols:"12",md:"4"},{default:s(()=>[d("div",ce," Order count: "+n(y(t.orderCountRange[0]))+" - "+n(y(t.orderCountRange[1])),1),l(_,{modelValue:t.orderCountRange,"onUpdate:modelValue":a=>t.orderCountRange=a,max:T,min:0,"thumb-size":18,"tick-size":3,"show-ticks":"",step:"1","thumb-label":""},{"thumb-label":s(({modelValue:a})=>[c(n(y(a)),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(i,{cols:"12",md:"4"},{default:s(()=>[d("div",ue," Total spent: "+n(v(t.totalSpentRange[0]))+" - "+n(v(t.totalSpentRange[1])),1),l(_,{modelValue:t.totalSpentRange,"onUpdate:modelValue":a=>t.totalSpentRange=a,max:x,min:0,"thumb-size":18,step:"1","thumb-label":""},{"thumb-label":s(({modelValue:a})=>[c(n(v(a)),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(i,{cols:"12",md:"4"},{default:s(()=>[d("div",pe," Loyalty points: "+n(g(t.loyaltyPointsRange[0]))+" - "+n(g(t.loyaltyPointsRange[1])),1),l(_,{modelValue:t.loyaltyPointsRange,"onUpdate:modelValue":a=>t.loyaltyPointsRange=a,max:U,min:0,"thumb-size":18,step:"1","thumb-label":""},{"thumb-label":s(({modelValue:a})=>[c(n(g(a)),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(i,{cols:"12",md:"4"},{default:s(()=>[d("div",fe," First order: "+n(R(t.firstOrderDateRange[0]))+" - "+n(R(t.firstOrderDateRange[1])),1),l(_,{modelValue:t.firstOrderDateRange,"onUpdate:modelValue":a=>t.firstOrderDateRange=a,max:0,min:A,"thumb-size":18,step:"1","thumb-label":""},{"thumb-label":s(({modelValue:a})=>[c(n(R(a)),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(i,{cols:"12",md:"4"},{default:s(()=>[d("div",_e," Last order: "+n(C(t.lastOrderDateRange[0]))+" - "+n(C(t.lastOrderDateRange[1])),1),l(_,{modelValue:t.lastOrderDateRange,"onUpdate:modelValue":a=>t.lastOrderDateRange=a,max:0,min:k,"thumb-size":18,"tick-size":3,"show-ticks":"",step:"1","thumb-label":""},{"thumb-label":s(({modelValue:a})=>[c(n(C(a)),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(i,{cols:"12",md:"5"},{default:s(()=>[l(b,{modelValue:t.lastOrderServiceTypes,"onUpdate:modelValue":a=>t.lastOrderServiceTypes=a,items:j,chips:"","closable-chips":"",label:"Select service type of the last order",multiple:"",style:{"min-width":"100%"}},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(i,{class:"d-inline-flex align-items-center justify-space-between gap-4 align-center",cols:"12",md:"7"},{default:s(()=>[l(I,{class:"d-inline-block align-baseline",density:"compact","hide-details":"",label:"Restrict by zip codes",onClick:a=>t.zipCodes=t.zipCodes===void 0?"":void 0},null,8,["onClick"]),t.zipCodes!==void 0?(f(),O(u,{key:0,modelValue:t.zipCodes,"onUpdate:modelValue":a=>t.zipCodes=a,class:"d-inline-block align-baseline",density:"compact",label:"zip codes (comma separated)",placeholder:"75001,75002,75003"},null,8,["modelValue","onUpdate:modelValue"])):z("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),d("div",be,[l(S,{disabled:!p(q),loading:p(L),onClick:J},{default:s(()=>o[4]||(o[4]=[c(" Next ")])),_:1,__:[4]},8,["disabled","loading"])])])}}});export{Ae as _};
